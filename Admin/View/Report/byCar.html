{extends file='../Public/template.html'}
{block name=pageContent}
<!-- BEGIN CONTENT BODY -->
<div class="page-content">

    <!--表格开始-->
    <!--全部出行表格-->
    <div class="row" id="waitReviewRow">

        <div class="col-md-12">
            <div class="portlet light bordered">
                <div class="portlet-title">
                    <div class="caption font-dark">
                        <i class="icon-settings font-dark"></i>
                        <span class="caption-subject bold uppercase">车辆数据统计</span>
                    </div>
                    <div class="tools">

                    </div>
                </div>

                <div class="portlet-body">
                    <form action="" method="post">
                        <div class="form-group" style="width: 190px; float: left;">
                            <div class="input-group date form_datetime col-md-5" id="startTimediv" data-date="" data-date-format="yyyy-mm-dd" data-link-field="dtp_input1">
                                <input id="startTime" name="startTime" class="form-control jt" size="16" type="text" value="{$startTime}" placeholder="开始时间" readonly style="width: 100px">
                                <span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span>
                                <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
                            </div>
                        </div>
                        <div class="form-group" style="width: 190px; float: left;">
                            <div class="input-group date form_datetime col-md-5" id="endTimediv" data-date="" data-date-format="yyyy-mm-dd" data-link-field="dtp_input1">
                                <input id="endTime" name="endTime" class="form-control jt" size="16" type="text" value="{$endTime}" placeholder="结束时间" readonly style="width: 100px">
                                <span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span>
                                <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
                            </div>
                        </div>
                        <div class="form-group" style="width: 160px; float: left; margin-right: 8px;">
                            <select name="car" class="form-control" id="car">
                                <option value="0">车辆(不限)</option>
                                {foreach $carsall as $k=>$v}
                                <option value="{$v.id}" {if $v.id eq $carname}selected{/if} >{$v.car_num}</option>
                                {/foreach}
                            </select>
                        </div>

                        <div class="form-group" style="width: 160px; float: left; margin-right: 8px;">
                            <select name="company" class="form-control" id="company">
                                <option value="0">单位(不限)</option>
                                {foreach $companysall as $k=>$v}
                                <option value="{$v.id}" {if $v.id eq $companyname}selected{/if}>{$v.company_name}</option>
                                {/foreach}
                            </select>
                        </div>

                        <div class="form-group" style="width: 160px; float: left; margin-right: 8px;">
                            <select name="type" class="form-control" id="type">
                                <option value="1" {if $type eq 1}selected{/if}>统计报表</option>
                                <option value="2" {if $type eq 2}selected{/if}>出行明细报表</option>
                            </select>
                        </div>


                        <button id="btn_add" type="submit" class="btn btn-default">
                            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>生成报表
                        </button>


                        {if $aa eq 1}
                        <button id="btn_addd" type="button" class="btn btn-default" onClick="dy();">
                            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>打印报表
                        </button>
                        {/if}


                    </form>
                </div>


                <!--startprint1-->
                {if $aa eq 1}
                {if $type eq 1}
                <div class="portlet-body">
                    <table width="100%" border="1" cellpadding="0" cellspacing="0" style="border-collapse:collapse; font-size:14px;">
                        <tr>
                            <td height="40" colspan="17" style="font-size:18px; text-align:center; line-height:40px;">公务用车平台车辆用车统计报表</td>
                        </tr>
                        <tr>
                            <td height="30" colspan="17" style="font-size:16px; text-align:center; line-height:30px;">开起始时间：{$startTime}&nbsp;&nbsp;&nbsp;&nbsp;截至时间：{$endTime}&nbsp;&nbsp;&nbsp;&nbsp;金额单位：元</td>
                        </tr>
                        <tr style="text-align:center; height:30px; line-height:30px;">
                            <td rowspan="2">车牌号码</td>
                            <td rowspan="2">出行次数</td>
                            <td rowspan="2">出行里程</td>
                            <td colspan="7">出行费用</td>
                            <td colspan="5">维修/保养费用</td>
                            <td rowspan="2">备注</td>
                        </tr>
                        <tr style="text-align:center; height:30px; line-height:30px;">
                            <td>路桥费</td>
                            <td>停车费</td>
                            <td>住宿费</td>
                            <td>出行服务费</td>
                            <td>出差补助</td>
                            <td>其他</td>
                            <td>小计</td>
                            <td>洗车</td>
                            <td>维修</td>
                            <td>加油</td>
                            <td>年检/保养</td>
                            <td>小计</td>
                        </tr>


                        {foreach $cars as $k=>$v}
                        {if $v.finishCount neq 0}
                        <tr class="trrrrr">
                            <td nowrap>{$v.car_num}</td>
                            <td>{$v.finishCount}</td>
                            <td>{$v.companyMileageCount}</td>
                            <td>{$v.luqiaoCount}</td>
                            <td>{$v.tingcheCount}</td>
                            <td>{$v.zhushuCount}</td>
                            <td>{$v.fuwufeiCount}</td>
                            <td>{$v.buzhuCount}</td>
                            <td>{$v.qitaCount}</td>
                            <td>{$v.heji}</td>
                            <td>{$v.xiche}</td>
                            <td>{$v.weixiu}</td>
                            <td>{$v.jiayou}</td>
                            <td>{$v.nianjian}</td>
                            <td>{$v.xiaoji}</td>
                            <td nowrap></td>
                        </tr>
                        {/if}
                        {/foreach}

                        <tr class="trrrrr">
                            <td>
                                <div align="center">合计</div>
                            </td>
                            <td>{$hj.finishCount}</td>
                            <td>{$hj.companyMileageCount}</td>
                            <td>{$hj.luqiaoCount}</td>
                            <td>{$hj.tingcheCount}</td>
                            <td>{$hj.zhushuCount}</td>
                            <td>{$hj.fuwufeiCount}</td>
                            <td>{$hj.buzhuCount}</td>
                            <td>{$hj.qitaCount}</td>
                            <td>{$hj.heji}</td>
                            <td>{$hj.xiche}</td>
                            <td>{$hj.weixiu}</td>
                            <td>{$hj.jiayou}</td>
                            <td>{$hj.nianjian}</td>
                            <td>{$hj.xiaoji}</td>
                            <td>
                                <div align="center"></div>
                            </td>
                        </tr>
                    </table>
                </div>
                {/if}

                {if $type eq 2}
                <div class="portlet-body">
                    <table width="100%" border="1" cellpadding="0" cellspacing="0" style="border-collapse:collapse; font-size:14px;">
                        <tr>
                            <td height="40" colspan="14" style="font-size:18px; text-align:center; line-height:40px;">公务用车平台单位用车出行明细报表</td>
                        </tr>
                        <tr>
                            <td height="30" colspan="14" style="font-size:16px; text-align:center; line-height:30px;">开起始时间：{$startTime}&nbsp;&nbsp;&nbsp;&nbsp;截至时间：{$endTime}&nbsp;&nbsp;&nbsp;&nbsp;金额单位：元</td>
                        </tr>
                        <tr style="text-align:center; height:30px; line-height:30px;">
                            <td rowspan="2">车牌号码</td>
                            <td rowspan="2">流水号</td>
                            <td rowspan="2">出车司机</td>
                            <td rowspan="2">用车单位</td>
                            <td rowspan="2">用车人</td>
                            <td rowspan="2">出车时间</td>
                            <td rowspan="2">目的地</td>
                            <td rowspan="2">出行里程</td>
                            <td colspan="5">出行费用</td>
                            <td rowspan="2" nowrap>备注</td>
                        </tr>
                        <tr style="text-align:center; height:30px; line-height:30px;">
                            <td>路桥费</td>
                            <td>出行服务费</td>
                            <td width="67px">出差补助</td>
                            <td>其他</td>
                            <td>小计</td>
                        </tr>

                        {$mileagenum=0}
                        {$fees_sumnum=0}
                        {$service_chargenum=0}
                        {$costnum=0}
                        {$totle_ratenum=0}

                        {foreach $travels as $k=>$v}
                        <tr class="trrrrr">
                            <td nowrap>{$v.car_num}</td>
                            <td>{$v.serial_number}</td>
                            <td>{$v.driver_name}</td>
                            <td nowrap>{$v.company_namee}</td>
                            <td>{$v.user_name}</td>
                            <td>{$v.start_car_time|date_format:'%Y-%m-%d %H:%M'}</td>
                            <td>{$v.to_place}</td>
                            <td>{$v.mileage}{$mileagenum=$mileagenum+$v.mileage}</td>
                            <td>{$v.fees_sum}{$fees_sumnum=$fees_sumnum+$v.fees_sum}</td>
                            <td>{$v.service_charge}{$service_chargenum=$service_chargenum+$v.service_charge}</td>
                            <td>0</td>
                            <td>{$v.else_cost}{$costnum=$costnum+$v.else_cost}</td>
                            <td>{$v.totle_rate}{$totle_ratenum=$totle_ratenum+$v.totle_rate}</td>
                            <td nowrap></td>
                        </tr>
                        {/foreach}
                        <tr class="trrrrr">
                            <td nowrap>合计</td>
                            <td></td>
                            <td></td>
                            <td nowrap></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td>{$mileagenum}</td>
                            <td>{$fees_sumnum}</td>
                            <td>{$service_chargenum}</td>
                            <td>0</td>
                            <td>{$costnum}</td>
                            <td>{$totle_ratenum}</td>
                            <td nowrap></td>
                        </tr>


                    </table>
                </div>
                {/if}


                {/if}
                <!--endprint1-->
            </div>
        </div>
    </div>
</div>
{/block}

{block name=script}
<!--[if lt IE 9]>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/respond.min.js"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/excanvas.min.js"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/ie8.fix.min.js"></script>
<![endif]-->
<!-- BEGIN CORE PLUGINS -->
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/jquery.min.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/js.cookie.min.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/jquery.blockui.min.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/bootstrap-switch/js/bootstrap-switch.min.js" type="text/javascript"></script>
<!-- END CORE PLUGINS -->
<!-- BEGIN PAGE LEVEL PLUGINS -->
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/moment.min.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/bootstrap-daterangepicker/daterangepicker.min.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/morris/morris.min.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/morris/raphael-min.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/counterup/jquery.waypoints.min.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/counterup/jquery.counterup.min.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/amcharts/amcharts/amcharts.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/amcharts/amcharts/serial.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/amcharts/amcharts/pie.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/amcharts/amcharts/radar.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/amcharts/amcharts/themes/light.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/amcharts/amcharts/themes/patterns.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/amcharts/amcharts/themes/chalk.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/amcharts/ammap/ammap.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/amcharts/ammap/maps/js/worldLow.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/amcharts/amstockcharts/amstock.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/fullcalendar/fullcalendar.min.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/horizontal-timeline/horizontal-timeline.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/flot/jquery.flot.min.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/flot/jquery.flot.resize.min.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/flot/jquery.flot.categories.min.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/jquery-easypiechart/jquery.easypiechart.min.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/jquery.sparkline.min.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/jqvmap/jqvmap/jquery.vmap.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/jqvmap/jqvmap/maps/jquery.vmap.russia.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/jqvmap/jqvmap/maps/jquery.vmap.world.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/jqvmap/jqvmap/maps/jquery.vmap.europe.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/jqvmap/jqvmap/maps/jquery.vmap.germany.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/jqvmap/jqvmap/maps/jquery.vmap.usa.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/jqvmap/jqvmap/data/jquery.vmap.sampledata.js" type="text/javascript"></script>
<!-- END PAGE LEVEL PLUGINS -->
<!-- BEGIN THEME GLOBAL SCRIPTS -->
<script src="{$smarty.const.PUBLIC_URL}/assets/global/scripts/app.min.js" type="text/javascript"></script>
<!-- END THEME GLOBAL SCRIPTS -->
<!-- BEGIN PAGE LEVEL SCRIPTS -->
<script src="{$smarty.const.PUBLIC_URL}/assets/pages/scripts/dashboard.min.js" type="text/javascript"></script>
<!-- END PAGE LEVEL SCRIPTS -->
<!-- BEGIN THEME LAYOUT SCRIPTS -->
<script src="{$smarty.const.PUBLIC_URL}/assets/layouts/layout/scripts/layout.min.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/layouts/layout/scripts/demo.min.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/layouts/global/scripts/quick-sidebar.min.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/layouts/global/scripts/quick-nav.min.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/bootstrap-daterangepicker/daterangepicker.min.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/bootstrap-datepicker/js/bootstrap-datepicker.min.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/bootstrap-timepicker/js/bootstrap-timepicker.min.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.zh-CN.js" type="text/javascript"></script>
<!-- END THEME LAYOUT SCRIPTS -->
<!-- BEGIN PAGE LEVEL SCRIPTS -->
<script src="{$smarty.const.PUBLIC_URL}/assets/global/scripts/datatable.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/datatables/language.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/datatables/datatables.min.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/template.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/bootstrap-sweetalert/sweetalert.min.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/assets/global/plugins/bootbox/bootbox.min.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/plugin/layer/layer.js" type="text/javascript"></script>
<script src="{$smarty.const.PUBLIC_URL}/js/js.js" type="text/javascript"></script>
<link rel="stylesheet" href="{$smarty.const.PUBLIC_URL}css/bootstrap-multiselect.css" type="text/css"/>
<script type="text/javascript" src="{$smarty.const.PUBLIC_URL}js/bootstrap-multiselect.js"></script>
<!-- END PAGE LEVEL SCRIPTS -->
<script>
    function dy() {
        preview(1);
    }

    function preview(oper) {
        if (oper < 10) {
            bdhtml = window.document.body.innerHTML;//获取当前页的html代码
            sprnstr = "<!--startprint" + oper + "-->";//设置打印开始区域
            eprnstr = "<!--endprint" + oper + "-->";//设置打印结束区域
            prnhtml = bdhtml.substring(bdhtml.indexOf(sprnstr) + 18); //从开始代码向后取html

            prnhtml = prnhtml.substring(0, prnhtml.indexOf(eprnstr));//从结束代码向前取html
            window.document.body.innerHTML = prnhtml;
            window.print();
            window.document.body.innerHTML = bdhtml;
        } else {
            window.print();
        }
    }

    jQuery(document).ready(function () {
        $('.form_datetime').datetimepicker({
            language: 'zh-CN',
            weekStart: 1,
            todayBtn: 1,
            autoclose: 1,
            todayHighlight: 1,
            startView: 2,
            forceParse: 0,
            minView: 2,
            showMeridian: 1
        }).on('changeDate', function (ev) {
            //fiflt();
        });

        //用车人选择
        $('#car').multiselect({
            includeSelectAllOption: true,
            enableFiltering: true,
            maxHeight: 200
        });//用车人选择

        //用车人选择
        $('#company').multiselect({
            includeSelectAllOption: true,
            enableFiltering: true,
            maxHeight: 200
        });//用车人选择
    });
</script>
{/block}